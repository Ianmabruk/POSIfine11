import{a as Mt,b as Bt,g as _t,r,u as ye,c as Nt,R as vt,d as Y,B as zt,N as se,e as Ht}from"./vendor-Ct1st1Nj.js";import{C as He,D as pe,T as Be,P as Ee,S as wt,a as Je,b as St,c as oe,d as Jt,e as Kt,f as Se,g as ke,h as me,i as kt,j as Wt,k as Ct,l as Gt,L as ce,U as ht,m as ut,n as Le,E as dt,M as pt,o as Pe,X as Ue,p as ge,q as _e,r as mt,s as Ke,t as gt,u as We,B as xt,R as Pt,I as Vt,v as Ge,w as ot,x as Ce,y as Ve,z as At,A as Qt,F as Tt,G as Yt,H as Zt,J as Xt,K as tt,N as es,O as Re,Q as It,V as Qe,Z as $e,W as Ye,Y as Dt,_ as ts,$ as ss,a0 as as,a1 as rs,a2 as ls,a3 as ns}from"./icons-BXlvFyWb.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&f(s)}).observe(document,{childList:!0,subtree:!0});function g(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function f(n){if(n.ep)return;n.ep=!0;const a=g(n);fetch(n.href,a)}})();var it={exports:{}},Ae={};var ft;function is(){if(ft)return Ae;ft=1;var t=Mt(),i=Symbol.for("react.element"),g=Symbol.for("react.fragment"),f=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(d,o,m){var N,y={},l=null,I=null;m!==void 0&&(l=""+m),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(I=o.ref);for(N in o)f.call(o,N)&&!a.hasOwnProperty(N)&&(y[N]=o[N]);if(d&&d.defaultProps)for(N in o=d.defaultProps,o)y[N]===void 0&&(y[N]=o[N]);return{$$typeof:i,type:d,key:l,ref:I,props:y,_owner:n.current}}return Ae.Fragment=g,Ae.jsx=s,Ae.jsxs=s,Ae}var bt;function cs(){return bt||(bt=1,it.exports=is()),it.exports}var e=cs(),qe={},jt;function os(){if(jt)return qe;jt=1;var t=Bt();return qe.createRoot=t.createRoot,qe.hydrateRoot=t.hydrateRoot,qe}var ds=os();const ms=_t(ds),xs=()=>"https://posifine22.onrender.com/api",G=xs(),Et=()=>localStorage.getItem("token"),Lt=async(t,i={},g=0,f=3)=>{const n=Et(),a=t.startsWith("/")?t:`/${t}`,s={...i,headers:{"Content-Type":"application/json",...n&&!(a.startsWith("/auth")&&a!=="/auth/me")&&!a.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...i.headers}};try{const d=await fetch(`${G}${a}`,s);if(d.status===401){if(a.includes("/auth/login")||a.includes("/main-admin/auth/login")){const y=await d.json().catch(()=>({error:"Unauthorized"}));throw new Error(y.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const m=window.location.pathname||"";if(!m.includes("/login")&&!m.includes("/signup")&&!m.includes("/auth")&&!m.includes("/main.admin"))try{window.location.href="/login"}catch{}const N=new Error("Unauthorized");throw N.status=401,N}if(d.status===500)throw new Error("Server error 500 - Backend unavailable");if(d.ok)return d.status===204?{success:!0}:await d.json();const o=await d.json().catch(()=>({error:"Network error"}));throw new Error(o.error||`HTTP ${d.status}: ${d.statusText}`)}catch(d){if(d.name==="TypeError"&&d.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${g+1}/${f+1}):`,d),console.error("Attempted URL:",`${G}${a}`),g<f){const o=Math.min(1e3*Math.pow(2,g),1e4);return console.log(`Retrying in ${o}ms...`),await new Promise(m=>setTimeout(m,o)),Lt(t,i,g+1,f)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw d}},B=(t,i={})=>Lt(t,i,0,3),we={login:t=>B("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>B("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>B("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>B("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>B("/auth/me")},Ne={getAll:()=>B("/users"),create:t=>B("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>B(`/users/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>B(`/users/${t}`,{method:"DELETE"}),setPin:(t,i)=>B(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:i})}),lock:(t,i)=>B(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:i})})},de={getAll:()=>B("/products"),create:t=>B("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>B(`/products/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>B(`/products/${t}`,{method:"DELETE"}),updateStock:(t,i)=>B(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(i)}),getMaxProducible:t=>B(`/products/${t}/max-producible`)},Fe={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Ze={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Ut={get:async()=>({totalSales:1500,totalExpenses:300,profit:1200,productCount:5})},Me={getAll:()=>B("/discounts"),create:t=>B("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>B(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>B(`/discounts/${t}`,{method:"DELETE"})},ct={getAll:()=>B("/credit-requests"),create:t=>B("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>B(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>B(`/credit-requests/${t}/reject`,{method:"POST"})},Ie={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},Xe={getAll:t=>{const i=t?`/batches?productId=${t}`:"/batches";return B(i)},create:t=>B("/batches",{method:"POST",body:JSON.stringify(t)})},De={login:t=>B("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return B("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return B("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return B("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return B("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return B("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,i)=>{const g=localStorage.getItem("ownerToken");return B(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({locked:i})})},changePlan:(t,i)=>{const g=localStorage.getItem("ownerToken");return B(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({plan:i})})},clearData:t=>{const i=localStorage.getItem("ownerToken");return B("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:JSON.stringify({type:t})})}};let ie=null,ze=new Set;function hs(){const t=G.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function us(){if(ie&&(ie.readyState===WebSocket.OPEN||ie.readyState===WebSocket.CONNECTING))return;const t=Et(),i=hs()+(t?`?token=${encodeURIComponent(t)}`:"");ie=new WebSocket(i),ie.onopen=()=>{console.debug("Products WS connected")},ie.onmessage=g=>{let f=null;try{f=JSON.parse(g.data)}catch{return}ze.forEach(n=>{try{n(f)}catch(a){console.error("ws callback error",a)}})},ie.onclose=()=>{console.debug("Products WS closed"),ie=null},ie.onerror=g=>{console.error("Products WS error",g)}}function ps(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return ze.add(t),us(),()=>{if(ze.delete(t),ie&&ze.size===0){try{ie.close()}catch{}ie=null}}}const $t=r.createContext(),fe=()=>r.useContext($t),gs=({children:t})=>{const[i,g]=r.useState(null),[f,n]=r.useState(!0),[a,s]=r.useState(!1),[d,o]=r.useState({});r.useEffect(()=>{m()},[]),r.useEffect(()=>{const P=()=>{const L=localStorage.getItem("user");if(L)try{const O=JSON.parse(L);g(O)}catch(O){console.warn("Failed to parse user from localStorage",O)}else g(null)};return window.addEventListener("storage",P),window.addEventListener("localStorageUpdated",P),()=>{window.removeEventListener("storage",P),window.removeEventListener("localStorageUpdated",P)}},[]);const m=async()=>{try{const P=localStorage.getItem("token"),L=localStorage.getItem("user");if(P)try{const O=await fetch(`${G}/auth/me`,{headers:{Authorization:`Bearer ${P}`,"Content-Type":"application/json"}});if(O.ok){const _=await O.json();g(_),localStorage.setItem("user",JSON.stringify(_))}else throw new Error("Invalid token")}catch(O){console.warn("Auth check failed:",O),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(P){console.error("Error initializing auth:",P),localStorage.removeItem("token"),localStorage.removeItem("user"),g(null)}finally{n(!1),s(!0)}},N=async P=>{try{if(P&&P.token&&P.user)return localStorage.setItem("token",P.token),localStorage.setItem("user",JSON.stringify(P.user)),g(P.user),P;const L=await we.login(P);if(L.token&&L.user)return localStorage.setItem("token",L.token),localStorage.setItem("user",JSON.stringify(L.user)),g(L.user),L;throw new Error("Invalid response from server")}catch(L){throw console.error("Login failed:",L),L}},y=async P=>{try{const L=await we.signup(P);if(L.token&&L.user)return localStorage.setItem("token",L.token),localStorage.setItem("user",JSON.stringify(L.user)),g(L.user),L;throw new Error("Invalid response from server")}catch(L){throw console.error("Signup failed:",L),L}},l=async P=>{try{if(localStorage.setItem("user",JSON.stringify(P)),g(P),window.dispatchEvent(new Event("localStorageUpdated")),P&&P.id)try{await Ne.update(P.id,P)}catch(L){console.warn("Failed to persist updated user to backend",L)}return P}catch(L){throw console.error("updateUser failed:",L),L}},I=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),g(null),window.location.href="/login"},h=()=>!!i&&!!localStorage.getItem("token"),v=P=>i&&i.role===P,u=()=>i&&(i.role==="admin"||i.role==="main-admin"),j=()=>i&&i.role==="cashier",k=()=>i&&i.plan==="ultra",C=()=>i&&i.plan==="basic",A=()=>i&&(i.role==="admin"||i.role==="cashier"),M=()=>i&&i.role==="admin"&&i.plan==="ultra",b=()=>i&&i.role==="admin",w=()=>!0,p=()=>!0;return i?.locked?e.jsx(LockedAccount,{}):e.jsx($t.Provider,{value:{user:i,loading:f,isInitialized:a,appSettings:d,login:N,signup:y,updateUser:l,logout:I,isAuthenticated:h,hasRole:v,isAdmin:u,isCashier:j,isUltraPackage:k,isBasicPackage:C,canEditStock:A,canManageUsers:M,canViewAnalytics:b,isRealTimeProductSyncEnabled:w,isCashierUserManagementEnabled:p},children:t})};new Date().toISOString();const Ft=r.createContext(),fs=()=>r.useContext(Ft),bs=({children:t})=>{const{user:i}=fe(),[g,f]=r.useState([]),[n,a]=r.useState(!0),[s,d]=r.useState(null),[o,m]=r.useState(Date.now()),N=r.useCallback(async()=>{if(!localStorage.getItem("token")){a(!1);return}try{const l=await de.getAll(),h=(Array.isArray(l)?l:[]).filter(v=>i?.role==="admin"?!0:!v.expenseOnly&&!v.pendingDelete&&v.visibleToCashier!==!1);f(h),d(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:h,timestamp:Date.now()}}))}catch(l){console.error("Failed to fetch products:",l),d(`Failed to load products: ${l.message}`),f([])}finally{a(!1),m(Date.now())}},[i]);r.useEffect(()=>{N()},[N,i]),r.useEffect(()=>{const l=setInterval(()=>{N()},2e3);return()=>clearInterval(l)},[N]);const y=async()=>{a(!0),await N()};return e.jsx(Ft.Provider,{value:{products:g,loading:n,error:s,lastUpdated:o,refreshProducts:y},children:t})};function js(){const[t,i]=r.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[g,f]=r.useState(!0),[n,a]=r.useState(null);r.useEffect(()=>{s()},[]);const s=async()=>{try{a(null);const[m,N]=await Promise.all([Ut.get(),Fe.getAll()]),y={totalSales:m?.totalSales||0,totalExpenses:m?.totalExpenses||0,profit:m?.profit||0,grossProfit:m?.grossProfit||0,netProfit:m?.netProfit||0,totalCOGS:m?.totalCOGS||0,dailySales:m?.dailySales||0,weeklySales:m?.weeklySales||0,productCount:m?.productCount||0},l=Array.isArray(N)?N:[];i({stats:y,recentSales:l.slice(-10).reverse()})}catch(m){console.error("Failed to load data:",m),a(m.message),i({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{f(!1)}};if(g)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(He,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:s,className:"btn-primary",children:"Retry"})]})});const d=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:pe,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Be,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ee,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Be,color:"from-purple-500 to-pink-600",change:"+15.3%"}],o=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:wt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Be,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:Je,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ee,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(d||[]).map((m,N)=>{const y=m?.icon;return y?e.jsxs("div",{className:`card bg-gradient-to-br ${m.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:m.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:m.label}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},N):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(o||[]).map((m,N)=>{const y=m?.icon;return y?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.color} flex items-center justify-center`,children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:m.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:m.value})]})]})},N):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(He,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(m=>m?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(m.items)?m.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",m.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",m.profit?.toLocaleString()||0]})]},m.id||Math.random()):null)})]})})]})]})}const ys=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class Ns{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(i,g){return new Promise((f,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){f();return}if(!i){n(new Error("No token provided for WebSocket connection"));return}const a=`${ys()}/ws/products?token=${encodeURIComponent(i)}`;try{this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,f()},this.ws.onmessage=s=>{try{const d=JSON.parse(s.data);d.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",d.data),g&&g(d.data),this.emit("stock_updated",d.data)):d.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",d.products)):d.type==="heartbeat"&&this.emit("heartbeat",d)}catch(d){console.error("Error parsing WebSocket message:",d)}},this.ws.onerror=s=>{console.error("âŒ WebSocket error:",s),this.emit("error",s),n(s)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(i,g)}}catch(s){console.error("Failed to create WebSocket:",s),n(s)}})}attemptReconnect(i,g){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const f=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${f}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(i,g).catch(n=>{console.error("Reconnection failed:",n)})},f)}on(i,g){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(g)}emit(i,g){this.listeners[i]&&this.listeners[i].forEach(f=>{try{f(g)}catch(n){console.error(`Error in ${i} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const et=new Ns;function vs(){const{user:t,isUltraPackage:i,isRealTimeProductSyncEnabled:g}=fe(),{products:f,refreshProducts:n}=fs(),[a,s]=r.useState([]),[d,o]=r.useState([]),[m,N]=r.useState("all"),[y,l]=r.useState(""),[I,h]=r.useState(!1),[v,u]=r.useState(!1),[j,k]=r.useState(!1),[C,A]=r.useState(null),[M,b]=r.useState(null),[w,p]=r.useState(null),[P,L]=r.useState(!1),[O,_]=r.useState(null),[ee,ae]=r.useState(""),[J,te]=r.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[Z,R]=r.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[q,V]=r.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});r.useEffect(()=>{xe();const x=localStorage.getItem("token");return x&&et.connect(x,T=>{T&&T.allProducts&&s(T.allProducts)}).catch(T=>{console.warn("WebSocket connection failed:",T)}),()=>{et.disconnect()}},[]);const xe=async()=>{try{await n();const x=await Xe.getAll();o(x)}catch(x){console.error("Failed to load data:",x)}};r.useEffect(()=>{f&&s(f)},[f]);const S=(x,T=!0)=>{const D=x.target.files[0];if(D){if(D.size>2*1024*1024){H("Image must be smaller than 2MB","error");return}const Q=new FileReader;Q.onload=K=>{const X=K.target.result;ae(X),T?te({...J,image:X}):(V({...q,image:X}),q.id&&setTimeout(async()=>{try{await de.update(q.id,{image:X}),H("âœ… Image saved","success")}catch(je){console.error("Failed to save image:",je)}},500))},Q.readAsDataURL(D)}},$=x=>d.filter(D=>D.productId===x&&D.quantity>0).reduce((D,Q)=>D+Q.quantity,0),z=x=>d.filter(T=>T.productId===x&&T.quantity>0),H=(x,T="success")=>{p({message:x,type:T}),setTimeout(()=>p(null),5e3)},re=async x=>{x.preventDefault();try{const T={...J,price:parseFloat(J.price),cost:parseFloat(J.cost||0),quantity:0,visibleToCashier:!J.expenseOnly&&J.visibleToCashier!==!1},D=await de.create(T);te({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),ae(""),h(!1),await xe(),H(`âœ… Product "${D.name}" added successfully! ${D.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(T){console.error("Failed to create product:",T),alert(`Failed to create product: ${T.message||"Unknown error"}`)}},le=async x=>{x.preventDefault();try{const T={id:`batch-${Date.now()}`,productId:C.id,quantity:parseInt(Z.quantity),expiryDate:Z.expiryDate,batchNumber:Z.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Z.cost||C.cost||0)};o(D=>[...D,T]),H("âš¡ Adding stock...","info");try{await Xe.create({productId:C.id,quantity:parseInt(Z.quantity),expiryDate:Z.expiryDate,batchNumber:Z.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Z.cost||C.cost||0)}),R({quantity:"",expiryDate:"",batchNumber:"",cost:""}),k(!1),A(null),await xe(),H(`âœ… Stock added successfully for ${C.name}!`,"success")}catch(D){throw o(Q=>Q.filter(K=>K.id!==T.id)),D}}catch(T){console.error("Failed to add stock:",T),H(`âŒ Failed to add stock: ${T.message||"Unknown error"}`,"error")}},be=async x=>{x.preventDefault();try{const T=a.find(K=>K.id===q.id);if(parseFloat(q.price)<T.price){alert("You cannot lower prices, only increase.");return}const D={...q,price:parseFloat(q.price),cost:parseFloat(q.cost),quantity:parseFloat(q.quantity)},Q={...T,...D};s(K=>K.map(X=>X.id===q.id?Q:X)),L(!0),H("âš¡ Updating product...","info");try{const K=await de.update(q.id,D);u(!1),g()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:K,originalProduct:T,timestamp:new Date().toISOString(),type:"update"}})),H("âœ… Product updated and synced!","success")):H("âœ… Product updated successfully!","success"),_(new Date)}catch(K){throw s(X=>X.map(je=>je.id===q.id?T:je)),K}finally{L(!1)}}catch(T){console.error("Failed to update product:",T),H(`âŒ Update failed: ${T.message||"Unknown error"}`,"error")}},st=async x=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const T=a.find(Q=>Q.id===x),D=await de.delete(x);if(s(Q=>Q.filter(K=>K.id!==x)),g()&&T)L(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:T,timestamp:new Date().toISOString(),type:"delete"}})),H(`ðŸ“¡ Product "${T.name}" deleted and synced to all dashboards!`,"success"),_(new Date),setTimeout(()=>{L(!1)},3e3);else{const Q=D?.message||"Product deleted successfully!";alert(Q)}await n()}catch(T){console.error("Failed to delete product:",T);let D="Failed to delete product";T.message.includes("Failed to execute")||T.message.includes("JSON")?D="Network error. Please check your connection and try again.":T.message.includes("401")||T.message.includes("unauthorized")?D="You are not authorized to delete this product.":T.message.includes("404")||T.message.includes("not found")?D="Product not found. It may have been deleted already.":T.message&&(D=`Failed to delete product: ${T.message}`),alert(D)}},at=(a||[]).filter(x=>{if(!x)return!1;const T=x.name?.toLowerCase().includes(y.toLowerCase()),D=m==="all"||m==="raw"&&!x.recipe||m==="composite"&&x.recipe||m==="expense"&&x.expenseOnly||m==="low-stock"&&x.quantity<10;return T&&D}),rt=(a||[]).filter(x=>x&&!x.recipe&&!x.expenseOnly),he=(a||[]).filter(x=>x&&x.recipe),lt=(a||[]).filter(x=>x&&x.expenseOnly),ve=x=>{if(!x||!x.recipe)return 0;let T=1/0;return(x.recipe||[]).forEach(D=>{if(!D)return;const Q=(a||[]).find(K=>K&&K.id===D.productId);if(Q&&Q.quantity>0&&D.quantity>0){const K=Math.floor(Q.quantity/D.quantity);T=Math.min(T,K)}}),T===1/0?0:T},nt=x=>{if(!x)return 0;if(!x.recipe)return x.cost||0;let T=0;return(x.recipe||[]).forEach(D=>{if(!D)return;const Q=(a||[]).find(K=>K&&K.id===D.productId);if(Q&&Q.quantity>0){const K=(Q.cost||0)/Q.quantity;T+=K*(D.quantity||0)}}),T};return e.jsxs("div",{className:"p-6 space-y-6",children:[w&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${w.type==="success"?"bg-green-50 border border-green-200 text-green-800":w.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:w.message}),e.jsx("button",{onClick:()=>p(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:y,onChange:x=>l(x.target.value)})]}),e.jsxs("select",{value:m,onChange:x=>N(x.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:rt.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:he.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:lt.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(at||[]).map(x=>{if(!x)return null;const T=nt(x),D=x.price?((x.price-T)/x.price*100).toFixed(1):0,Q=ve(x),K=M===x.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[x.image?e.jsx("img",{src:x.image,alt:x.name,className:"w-12 h-12 object-cover rounded-lg",onError:X=>{X.target.style.display="none",X.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:x.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[x.recipe&&e.jsx("button",{onClick:()=>b(K?null:x.id),className:"p-1 hover:bg-gray-200 rounded",children:K?e.jsx(Jt,{className:"w-4 h-4"}):e.jsx(Kt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:x.name}),x.quantity<10&&!x.recipe&&e.jsx(Se,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${x.expenseOnly?"badge-warning":x.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:x.expenseOnly?"Expense":x.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",x.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",T.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${$(x.id)===0?"text-red-600":$(x.id)<10?"text-yellow-600":"text-gray-900"}`,children:[$(x.id)," ",x.unit]}),$(x.id)<10&&$(x.id)>0&&e.jsx(Se,{className:"w-4 h-4 text-yellow-500"}),$(x.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[z(x.id).length," active"]}),e.jsx("button",{onClick:()=>{A(x),k(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(oe,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:x.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[Q," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${D>30?"text-green-600":D>15?"text-yellow-600":"text-red-600"}`,children:[D,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{V(x),u(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>st(x.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},x.id),K&&x.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(x.recipe||[]).map((X,je)=>{if(!X)return null;const ue=(a||[]).find(E=>E&&E.id===X.productId);if(!ue)return null;const c=(ue.cost||0)/(ue.quantity||1),U=c*(X.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:ue.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[X.quantity||0," ",ue.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[ue.quantity||0," ",ue.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",c.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",U.toFixed(2)]})]},je)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",T.toFixed(2)]})]})})]})]})})})]})})})]})})}),j&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",C.name]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:Z.quantity,onChange:x=>R({...Z,quantity:x.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:Z.expiryDate,onChange:x=>R({...Z,expiryDate:x.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:Z.batchNumber,onChange:x=>R({...Z,batchNumber:x.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:Z.cost,onChange:x=>R({...Z,cost:x.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{k(!1),A(null),R({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:J.name,onChange:x=>te({...J,name:x.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:x=>S(x,!0),className:"input"}),e.jsx(kt,{className:"w-5 h-5 text-gray-400"})]}),(ee||J.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ee||J.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:J.price,onChange:x=>te({...J,price:x.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:J.cost,onChange:x=>te({...J,cost:x.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:J.category,onChange:x=>te({...J,category:x.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:J.unit,onChange:x=>te({...J,unit:x.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:J.expenseOnly,onChange:x=>te({...J,expenseOnly:x.target.checked,visibleToCashier:!x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!J.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:J.visibleToCashier,onChange:x=>te({...J,visibleToCashier:x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{h(!1),ae(""),te({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:q.name,onChange:x=>V({...q,name:x.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:q.image||"",onChange:x=>V({...q,image:x.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:x=>{const T=x.target.files[0];if(T){const D=new FileReader;D.onloadend=()=>{V({...q,image:D.result})},D.readAsDataURL(T)}}})]}),q.image&&e.jsx("img",{src:q.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:q.price||"",onChange:x=>V({...q,price:x.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:q.cost||"",onChange:x=>V({...q,cost:x.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:q.quantity||"",onChange:x=>V({...q,quantity:x.target.value}),required:!0}),e.jsxs("select",{className:"input",value:q.unit||"pcs",onChange:x=>V({...q,unit:x.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:q.category||"raw",onChange:x=>V({...q,category:x.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q.expenseOnly||!1,onChange:x=>V({...q,expenseOnly:x.target.checked,visibleToCashier:!x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!q.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q.visibleToCashier!==!1,onChange:x=>V({...q,visibleToCashier:x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ws(){const[t,i]=r.useState([]),[g,f]=r.useState([]),[n,a]=r.useState(!1),[s,d]=r.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});r.useEffect(()=>{o()},[]);const o=async()=>{const v=await de.getAll();i(v),f(v.filter(u=>!u.recipe))},m=()=>{d({...s,ingredients:[...s.ingredients,{name:"",quantity:"",unit:"pcs"}]})},N=(v,u,j)=>{const k=[...s.ingredients];k[v][u]=j,d({...s,ingredients:k})},y=v=>{d({...s,ingredients:s.ingredients.filter((u,j)=>j!==v)})},l=()=>s.ingredients.reduce((v,u)=>{const j=g.find(k=>k.name.toLowerCase()===u.name.toLowerCase());if(j&&u.quantity){const k=j.cost/j.quantity;return v+k*parseFloat(u.quantity)}return v},0),I=async v=>{v.preventDefault();const u=[];for(const k of s.ingredients){if(!k.name||!k.quantity)continue;const C=g.find(A=>A.name.toLowerCase()===k.name.toLowerCase());C?u.push({productId:C.id,quantity:parseFloat(k.quantity),unit:k.unit||"pcs"}):u.push({name:k.name,quantity:parseFloat(k.quantity),unit:k.unit||"pcs"})}if(u.length===0){alert("Please add at least one ingredient");return}const j=l();try{await de.create({name:s.name,price:parseFloat(s.price),cost:j,quantity:0,unit:"pcs",category:"composite",recipe:u,image:s.image||"",visibleToCashier:s.visibleToCashier,expenseOnly:!1}),d({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),a(!1),o(),alert("Recipe created successfully!")}catch(k){console.error("Error creating recipe:",k),alert("Failed to create recipe. Please try again.")}},h=t.filter(v=>v.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>a(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",h.length,")"]}),h.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:h.map(v=>{const u=v.recipe.reduce((k,C)=>{if(C.productId){const A=t.find(M=>M.id===C.productId);if(A){const M=A.cost/A.quantity;return k+M*C.quantity}}else if(C.name){const A=t.find(M=>M.name.toLowerCase()===C.name.toLowerCase());if(A){const M=A.cost/A.quantity;return k+M*C.quantity}}return k},0),j=((v.price-u)/v.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:v.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",v.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",u.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${j>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",j,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.recipe.map((k,C)=>{let A="",M=k.unit||"pcs";if(k.productId){const b=t.find(w=>w.id===k.productId);b&&(A=b.name,M=b.unit)}else k.name&&(A=k.name,M=k.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[k.quantity," ",M]})]},C):null})})]})]},v.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:s.name,onChange:v=>d({...s,name:v.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:s.price,onChange:v=>d({...s,price:v.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:s.image,onChange:v=>d({...s,image:v.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.visibleToCashier,onChange:v=>d({...s,visibleToCashier:v.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:m,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:s.ingredients.map((v,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:v.name,onChange:j=>N(u,"name",j.target.value),required:!0,list:`ingredients-list-${u}`}),e.jsx("datalist",{id:`ingredients-list-${u}`,children:g.map(j=>e.jsxs("option",{value:j.name,children:[j.name," (",j.quantity," ",j.unit," available)"]},j.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:v.quantity,onChange:j=>N(u,"quantity",j.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:v.unit,onChange:j=>N(u,"unit",j.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>y(u),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(me,{className:"w-4 h-4"})})]},u))}),s.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),s.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",l().toFixed(2)]})]}),s.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(s.price)-l())/parseFloat(s.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{a(!1),d({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ss(){const[t,i]=r.useState([]),[g,f]=r.useState("all"),[n,a]=r.useState([]),[s,d]=r.useState(!1);r.useEffect(()=>{o()},[]);const o=async()=>{const u=await Fe.getAll();i(u.reverse())},m=async u=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{d(!0);const j=localStorage.getItem("token");if(!(await fetch(`${G}/sales/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${j}`}})).ok)throw new Error("Failed to delete sale");i(t.filter(C=>C.id!==u)),alert("Sale deleted successfully")}catch(j){alert("Failed to delete sale: "+j.message)}finally{d(!1)}},N=async()=>{if(n.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${n.length} sales? This action cannot be undone.`))try{d(!0);const u=localStorage.getItem("token");if(!(await fetch(`${G}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:n})})).ok)throw new Error("Failed to delete sales");i(t.filter(k=>!n.includes(k.id))),a([]),alert("Sales deleted successfully")}catch(u){alert("Failed to delete sales: "+u.message)}finally{d(!1)}},y=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{d(!0);const u=localStorage.getItem("token");if(!(await fetch(`${G}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");i([]),a([]),alert("All sales data cleared")}catch(u){alert("Failed to clear sales: "+u.message)}finally{d(!1)}},l=t.filter(u=>{if(g==="today")return new Date(u.createdAt).toDateString()===new Date().toDateString();if(g==="week"){const j=new Date;return j.setDate(j.getDate()-7),new Date(u.createdAt)>=j}return!0}),I=l.reduce((u,j)=>u+j.total,0),h=l.reduce((u,j)=>u+(j.cogs||0),0),v=I-h;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:g,onChange:u=>f(u.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," selected"]}),e.jsxs("button",{onClick:N,disabled:s,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:y,disabled:s||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",I.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:n.length===l.length&&l.length>0,onChange:u=>{u.target.checked?a(l.map(j=>j.id)):a([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:l.map(u=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.includes(u.id),onChange:j=>{j.target.checked?a([...n,u.id]):a(n.filter(k=>k!==u.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",u.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(u.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[u.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:u.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",u.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",u.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",u.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>m(u.id),disabled:s,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4"}),"Delete"]})})]},u.id))})]})})]})]})}function ks(){const[t,i]=r.useState([]),[g,f]=r.useState(!1),[n,a]=r.useState({description:"",amount:"",category:"general"});r.useEffect(()=>{s()},[]);const s=async()=>{const y=await Ze.getAll();i(y.reverse())},d=async y=>{y.preventDefault(),await Ze.create({...n,amount:parseFloat(n.amount)}),a({description:"",amount:"",category:"general"}),f(!1),s()},o=t.reduce((y,l)=>y+l.amount,0),m=t.filter(y=>!y.automatic),N=t.filter(y=>y.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.reduce((y,l)=>y+l.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.reduce((y,l)=>y+l.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(y.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:y.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${y.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:y.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",y.amount?.toLocaleString()]})]},y.id))})]})})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:y=>a({...n,description:y.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:y=>a({...n,amount:y.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:y=>a({...n,category:y.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Cs(){const{isCashierUserManagementEnabled:t,isCashier:i}=fe(),[g,f]=r.useState([]),[n,a]=r.useState(!0),[s,d]=r.useState(!1),[o,m]=r.useState(null),[N,y]=r.useState(null),[l,I]=r.useState(null),[h,v]=r.useState(0),[u,j]=r.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[k,C]=r.useState(!1),[A,M]=r.useState(null),[b,w]=r.useState("");r.useEffect(()=>{p()},[]),r.useEffect(()=>()=>{l?.intervalId&&clearInterval(l.intervalId)},[l]);const p=async()=>{try{a(!0);const S=await Ne.getAll();f(Array.isArray(S)?S:[])}catch(S){console.error("Error loading users:",S),f([])}finally{a(!1)}},P=()=>Math.floor(1e3+Math.random()*9e3).toString(),L=async S=>{if(S.preventDefault(),console.log("Form submitted with data:",u),!u.name?.trim()||!u.email?.trim()||!u.password?.trim()){alert("Please fill in all required fields");return}if(u.password.length<6){alert("Password must be at least 6 characters long");return}try{a(!0);const $=P(),z={name:u.name.trim(),email:u.email.trim().toLowerCase(),password:u.password.trim(),pin:$};console.log("Sending user data:",z);const H=await Ne.create(z);console.log("User creation result:",H),await p();const re=`âœ… Cashier added successfully!

ðŸ“§ Email: ${z.email}
ðŸ”‘ Password: ${z.password}
ðŸ”¢ PIN: ${$}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${$}

Please share these credentials securely with the new cashier.`;alert(re),j({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),d(!1)}catch($){console.error("Error creating cashier:",$);let z="Failed to add cashier";$.message.includes("Current user not found")?z="Authentication error. Please refresh the page and try again.":$.message.includes("email")?z="Email already exists. Please use a different email.":$.message.includes("network")||$.message.includes("fetch")?z="Network error. Please check your connection and try again.":$.message&&(z=`Failed to add cashier: ${$.message}`),alert(z)}finally{a(!1)}},O=async(S,$)=>{try{a(!0),await Ne.update(S,{permissions:$}),await p(),m(null)}catch(z){console.error("Error updating permissions:",z),alert("Failed to update permissions: "+z.message)}finally{a(!1)}},_=async(S,$)=>{try{a(!0);const z=!$,H=await fetch(`${G}/users/${S}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:z})});if(!H.ok){const re=await H.json().catch(()=>({error:"Network error"}));throw new Error(re.error||`HTTP ${H.status}: ${H.statusText}`)}await p()}catch(z){console.error("Error updating user status:",z),alert("Failed to update user status: "+z.message)}finally{a(!1)}},ee=async(S,$)=>{try{a(!0);const z=!$,H=await fetch(`${G}/users/${S}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:z})});if(!H.ok){const re=await H.json().catch(()=>({error:"Network error"}));throw new Error(re.error||`HTTP ${H.status}: ${H.statusText}`)}await p()}catch(z){console.error("Error updating user lock status:",z),alert("Failed to update user lock status: "+z.message)}finally{a(!1)}},ae=async S=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{a(!0),await Ne.delete(S),await p()}catch($){console.error("Error deleting user:",$),alert("Failed to delete user: "+$.message)}finally{a(!1)}},J=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{a(!0);const S=localStorage.getItem("token");if(!(await fetch(`${G}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");f([]),alert("All users data cleared")}catch(S){alert("Failed to clear users: "+S.message)}finally{a(!1)}},te=S=>{M(S),w(P()),C(!0)},Z=async()=>{try{a(!0),await Ne.update(A.id,{cashierPIN:b}),await p(),C(!1),M(null),w(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${b}

Please share this PIN securely with the cashier.`)}catch(S){console.error("Error resetting PIN:",S),alert("Failed to reset PIN: "+S.message)}finally{a(!1)}},R=S=>{y(S),I({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const $=setInterval(()=>{V(S)},3e3);I(z=>({...z,intervalId:$})),V(S)},q=()=>{l?.intervalId&&clearInterval(l.intervalId),y(null),I(null)},V=async S=>{try{const $=await Fe.getAll(),H=(Array.isArray($)?$:[]).filter(le=>le.cashierId===S.id).sort((le,be)=>new Date(be.createdAt)-new Date(le.createdAt)).slice(0,10),re={isActive:Math.random()>.3,currentCart:H.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:H.reduce((le,be)=>le+be.total,0),salesCount:H.length,lastActivity:H.length>0?new Date(H[0].createdAt).toLocaleTimeString():"No recent activity"};I(re)}catch($){console.error("Error loading live view data:",$)}},xe=(g||[]).filter(S=>S.role==="cashier");return n&&g.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:J,disabled:n||g.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),i()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:g.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:xe.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:g.filter(S=>S.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(g||[]).map(S=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:S.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${S.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:S.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:S.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:S.pin||S.cashierPIN||"----"}),e.jsx("button",{onClick:()=>te(S),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(ke,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:S.active?e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-3 h-3"}),"Inactive"]})}),S.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Le,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(S.id,S.active),className:`p-2 rounded-lg transition ${S.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:S.active?"Deactivate User":"Activate User",disabled:n,children:S.active?e.jsx(ut,{className:"w-4 h-4"}):e.jsx(ht,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(S.id,S.locked||!1),className:`p-2 rounded-lg transition ${S.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:S.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(Le,{className:"w-4 h-4"})})]}),S.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",S.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(S),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(pt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(S),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ae(S.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(me,{className:"w-4 h-4"})})]})]})})]},S.id))})]}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:u.name||"",onChange:S=>{console.log("Name input changed:",S.target.value),j({...u,name:S.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:u.email||"",onChange:S=>{console.log("Email input changed:",S.target.value),j({...u,email:S.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:u.password||"",onChange:S=>{console.log("Password input changed:",S.target.value),j({...u,password:S.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(u.permissions).map(([S,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:z=>j({...u,permissions:{...u.permissions,[S]:z.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",o.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(o.permissions||{}).map(([S,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:z=>m({...o,permissions:{...o.permissions,[S]:z.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>O(o.id,o.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>m(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),N&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(pt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",N.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:q,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:l.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ge,{className:"w-4 h-4"}),"Last Activity: ",l.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(l.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(l.currentCart||[]).map((S,$)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[S.name," x",S.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",S.price.toLocaleString()]})]},$)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(l.currentCart||[]).reduce((S,$)=>S+$.price*$.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:l.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",l.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",l.salesCount>0?Math.round(l.totalSalesToday/l.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),k&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:b})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(P()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:Z,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{C(!1),M(null),w("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function Ps(){const[t,i]=r.useState([]),[g,f]=r.useState("all");r.useEffect(()=>{n()},[]);const n=()=>{const o=JSON.parse(localStorage.getItem("clockRecords")||"[]");i(o.reverse())},a=g==="all"?t:t.filter(o=>o.date===new Date().toDateString()),s=a.filter(o=>o.date===new Date().toDateString()).reduce((o,m)=>o+m.duration,0)/60,d=o=>{const m=Math.floor(o/60),N=o%60;return`${m}h ${N}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[s.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(mt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(a.filter(o=>o.date===new Date().toDateString()).map(o=>o.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(Ke,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>f("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):a.map((o,m)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:o.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:d(o.duration)})})]},m))})]})})]})]})}function As(){const{user:t,updateUser:i}=fe();ye();const[g,f]=r.useState(!1),[n,a]=r.useState(t?.plan||"ultra"),[s,d]=r.useState({}),[o,m]=r.useState(null),[N,y]=r.useState(t?.profilePicture||null),[l,I]=r.useState(!0),[h,v]=r.useState(!0);r.useEffect(()=>{u()},[]);const u=async()=>{try{const p=await Ie.get();d(p),p.logo&&m(p.logo),I(p.cashierUserManagement!==!1),v(p.realTimeProductSync!==!1)}catch(p){console.error("Failed to load settings:",p)}},j=async p=>{try{const P={...s,...p};return await Ie.update(P),d(P),!0}catch(P){return console.error("Failed to save settings:",P),!1}},k=async()=>{const p=!l;I(p),await j({cashierUserManagement:p})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:p}})),alert(`âœ… Cashier User Management ${p?"ENABLED":"DISABLED"}`)):(I(!p),alert("âŒ Failed to save setting. Please try again."))},C=async()=>{const p=!h;v(p),await j({realTimeProductSync:p})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:p}})),alert(`âœ… Real-time Product Sync ${p?"ENABLED":"DISABLED"}`)):(v(!p),alert("âŒ Failed to save setting. Please try again."))},A=async p=>{const P=p.target.files[0];if(P){const L=new FileReader;L.onloadend=async()=>{const O=L.result;m(O);try{await Ie.update({...s,logo:O}),d({...s,logo:O})}catch(_){console.error("Failed to save logo:",_)}},L.readAsDataURL(P)}},M=async p=>{const P=p.target.files[0];if(P){const L=new FileReader;L.onloadend=async()=>{const O=L.result;y(O);try{await i({...t,profilePicture:O})}catch(_){console.error("Failed to save profile picture:",_)}},L.readAsDataURL(P)}},b=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],w=async()=>{const p=b.find(L=>L.id===n),P=n==="ultra"?"admin":"cashier";await i({...t,role:P,plan:n,price:p.price}),f(!1),setTimeout(()=>window.location.href=P==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(mt,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[N?e.jsx("img",{src:N,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:M})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(We,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>f(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Pe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:k,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${l?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${l?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${l?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:l?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Pt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:C,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${h?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${h?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${h?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:h?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Vt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[o&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:o,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:b.map(p=>e.jsxs("div",{onClick:()=>a(p.id),className:`card cursor-pointer transition-all ${n===p.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:p.name}),n===p.id&&e.jsx(Ge,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",p.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:p.features.map((P,L)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ge,{className:"w-4 h-4 text-green-600"}),P]},L))})]},p.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:w,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Ts(){const[t,i]=r.useState([]),[g,f]=r.useState(!1),[n,a]=r.useState(null),[s,d]=r.useState({name:"",amount:"",description:"",active:!0});r.useEffect(()=>{o()},[]);const o=()=>{const l=JSON.parse(localStorage.getItem("serviceFees")||"[]");i(l)},m=l=>{localStorage.setItem("serviceFees",JSON.stringify(l)),i(l)},N=l=>{if(l.preventDefault(),n){const I=t.map(h=>h.id===n.id?{...s,id:h.id}:h);m(I)}else{const I={...s,id:Date.now(),createdAt:new Date().toISOString()};m([...t,I])}f(!1),a(null),d({name:"",amount:"",description:"",active:!0})},y=l=>{confirm("Delete this service fee?")&&m(t.filter(I=>I.id!==l))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{f(!0),a(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(l=>e.jsxs("div",{className:`card ${l.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500",children:l.description})]})]}),e.jsx("span",{className:`badge ${l.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:l.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",l.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{a(l),d(l),f(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ke,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>y(l.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(me,{className:"w-4 h-4 text-red-600"})})]})]})]},l.id))}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:s.name,onChange:l=>d({...s,name:l.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:s.amount,onChange:l=>d({...s,amount:l.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:s.description,onChange:l=>d({...s,description:l.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.active,onChange:l=>d({...s,active:l.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Is(){const[t,i]=r.useState([]),[g,f]=r.useState([]),[n,a]=r.useState(!1),[s,d]=r.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});r.useEffect(()=>{o(),m()},[]);const o=async()=>{try{const h=localStorage.getItem("token"),v=await fetch(`${G}/reminders`,{headers:{Authorization:`Bearer ${h}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),i([]);return}const u=await v.json();Array.isArray(u)?i(u):(console.error("Expected array but got:",typeof u,u),i([]))}catch(h){console.error("Failed to fetch reminders:",h),i([])}},m=async()=>{try{const h=localStorage.getItem("token"),v=await fetch(`${G}/products`,{headers:{Authorization:`Bearer ${h}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),f([]);return}const u=await v.json();Array.isArray(u)?f(u):(console.error("Expected array but got:",typeof u,u),f([]))}catch(h){console.error("Failed to fetch products:",h),f([])}},N=async h=>{h.preventDefault();try{const v=localStorage.getItem("token"),u=await fetch(`${G}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify(s)});if(!u.ok){const k=await u.json();console.error("Failed to create reminder:",k),alert(`Failed to create reminder: ${k.error||"Unknown error"}`);return}const j=await u.json();d({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),a(!1),o(),alert("Reminder created successfully!")}catch(v){console.error("Failed to create reminder:",v),alert("Failed to create reminder. Please try again.")}},y=async h=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const u=localStorage.getItem("token"),j=await fetch(`${G}/reminders/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}});if(!j.ok){const k=await j.json();console.error("Failed to delete reminder:",k),alert(`Failed to delete reminder: ${k.error||"Unknown error"}`);return}o(),alert("Reminder deleted successfully!")}catch(v){console.error("Failed to delete reminder:",v),alert("Failed to delete reminder. Please try again.")}},l=h=>{s.days.includes(h)?d({...s,days:s.days.filter(v=>v!==h)}):d({...s,days:[...s.days,h]})},I=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(xt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>a(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(oe,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(h=>{const v=g.find(u=>u.id===h.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${h.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:h.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",v?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",h.frequency]}),h.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",h.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(Ke,{size:16}),"Next: ",new Date(h.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${h.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:h.status}),e.jsx("button",{onClick:()=>y(h.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(me,{size:20})})]})]})},h.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:s.customerName,onChange:h=>d({...s,customerName:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:s.productId,onChange:h=>d({...s,productId:parseInt(h.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),g.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:s.frequency,onChange:h=>d({...s,frequency:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),s.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(h=>e.jsx("button",{type:"button",onClick:()=>l(h),className:`px-4 py-2 rounded-lg font-medium transition ${s.days.includes(h)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:h},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:s.nextDate,onChange:h=>d({...s,nextDate:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>a(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Ds(){const[t,i]=r.useState([]),[g,f]=r.useState(!1),[n,a]=r.useState(null),[s,d]=r.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});r.useEffect(()=>{o()},[]);const o=async()=>{try{const l=await Me.getAll();i(l)}catch(l){console.error("Failed to load discounts:",l)}},m=async l=>{l.preventDefault();try{n?await Me.update(n.id,s):await Me.create(s),f(!1),a(null),d({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),o()}catch(I){console.error("Failed to save discount:",I)}},N=async l=>{if(confirm("Delete this discount?"))try{await Me.delete(l),o()}catch(I){console.error("Failed to delete discount:",I)}},y=l=>{const I=new Date,h=new Date(l.validFrom),v=new Date(l.validTo);return l.active&&h<=I&&v>=I};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{f(!0),a(null),d({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(l=>e.jsxs("div",{className:`card ${y(l)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${y(l)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[l.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${y(l)?"badge-success":"bg-gray-200 text-gray-600"}`,children:y(l)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(l.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(l.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{a(l),d(l),f(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ke,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>N(l.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(me,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},l.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(ot,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:s.name,onChange:l=>d({...s,name:l.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:s.percentage,onChange:l=>d({...s,percentage:parseFloat(l.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:s.validFrom,onChange:l=>d({...s,validFrom:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:s.validTo,onChange:l=>d({...s,validTo:l.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.active,onChange:l=>d({...s,active:l.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Es(){const[t,i]=r.useState([]),[g,f]=r.useState([]),[n,a]=r.useState("all");r.useEffect(()=>{s(),d()},[]);const s=async()=>{try{const h=await ct.getAll();i(h)}catch(h){console.error("Failed to load credit requests:",h)}},d=async()=>{try{const h=await de.getAll();f(h)}catch(h){console.error("Failed to load products:",h)}},o=async h=>{try{await ct.approve(h),s()}catch(v){console.error("Failed to approve request:",v)}},m=async h=>{try{await ct.reject(h),s()}catch(v){console.error("Failed to reject request:",v)}},N=h=>{const v=g.find(u=>u.id===h);return v?v.name:"Unknown Product"},y=t.filter(h=>n==="all"?!0:h.status===n),l=h=>{switch(h){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},I=h=>{switch(h){case"pending":return e.jsx(ge,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ce,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(Ve,{className:"w-6 h-6 text-red-600"});default:return e.jsx(We,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(h=>e.jsx("button",{onClick:()=>a(h),className:`px-4 py-2 rounded-lg font-medium transition ${n===h?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:h.charAt(0).toUpperCase()+h.slice(1)},h))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.map(h=>e.jsx("div",{className:`card border-l-4 ${l(h.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${h.status==="pending"?"bg-orange-600":h.status==="approved"?"bg-green-600":"bg-red-600"}`,children:I(h.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:h.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:N(h.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:h.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",h.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(h.createdAt).toLocaleString()]}),h.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(h.approvedAt).toLocaleString()]})]})]}),h.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o(h.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ce,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>m(h.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ve,{size:16}),"Reject"]})]}),h.status!=="pending"&&e.jsx("span",{className:`badge ${h.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:h.status.toUpperCase()})]})},h.id)),y.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Ot({onClose:t}){const[i,g]=r.useState([]),[f,n]=r.useState(!0);r.useEffect(()=>{a()},[]);const a=async()=>{try{const d=localStorage.getItem("token"),o=await fetch(`${G}/reminders/today`,{headers:{Authorization:`Bearer ${d}`}});if(!o.ok){console.error("API Error:",o.status,o.statusText),g([]);return}const m=await o.json();Array.isArray(m)?g(m):(console.error("Expected array but got:",typeof m,m),g([]))}catch(d){console.error("Failed to fetch reminders:",d),g([])}finally{n(!1)}},s=async d=>{try{const o=localStorage.getItem("token");await fetch(`${G}/reminders/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({status:"fulfilled"})}),a()}catch(o){console.error("Failed to update reminder:",o)}};return f?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ue,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(He,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):i.map(d=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:d.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",d.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:d.frequency})]}),e.jsxs("button",{onClick:()=>s(d.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ce,{size:18}),"Mark Done"]})]},d.id))})]})})}function Rt({onUnlock:t,userType:i="user"}){const[g,f]=r.useState(""),[n,a]=r.useState(""),[s,d]=r.useState("password"),[o,m]=r.useState(!1),[N,y]=r.useState(""),[l,I]=r.useState(!1),[h,v]=r.useState("2005"),u=JSON.parse(localStorage.getItem("user")||"{}");r.useEffect(()=>{(async()=>{try{const A=await Ie.get();A?.screenLockPassword&&v(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),r.useEffect(()=>{const C=document.getElementById(s==="password"?"unlock-password":"unlock-pin");C&&C.focus()},[s]);const j=async C=>{C.preventDefault(),C.stopPropagation(),I(!0),y("");try{if(s==="password")if(g===h)t();else throw new Error("Incorrect password");else if(s==="pin"&&u.pin)if(n===u.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${s}`)}catch(A){y(A.message||"Unlock failed")}finally{I(!1)}},k=C=>{const A=C.replace(/\D/g,"").slice(0,4);a(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:C=>C.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${i==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ce,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:i==="main_admin"?"Main Admin":u.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",s," to continue"]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[i!=="main_admin"&&u.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{d("password"),y("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${s==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{d("pin"),y("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${s==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(s==="password"||i==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:o?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:g,onChange:C=>f(C.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>m(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(At,{className:"w-5 h-5"}):e.jsx(dt,{className:"w-5 h-5"})})]}),s==="pin"&&i!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:n,onChange:C=>k(C.target.value),maxLength:4,required:!0})]}),N&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:N}),e.jsx("button",{type:"submit",disabled:l||s==="pin"&&n.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${i==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:l?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function qt(t=6e4){const[i,g]=r.useState(!1),[f,n]=r.useState(Date.now()),a=r.useCallback(()=>{n(Date.now()),i&&g(!1)},[i]),s=r.useCallback(()=>{g(!1),a()},[a]);return r.useEffect(()=>{const d=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{a()};d.forEach(N=>{document.addEventListener(N,o,!0)});const m=setInterval(()=>{Date.now()-f>t&&!i&&g(!0)},1e3);return()=>{d.forEach(N=>{document.removeEventListener(N,o,!0)}),clearInterval(m)}},[f,t,i,a]),[i,s,a]}function Ls(){const{user:t,logout:i,isCashierUserManagementEnabled:g}=fe(),f=ye(),n=Nt(),[a,s]=r.useState(!0),[d,o]=r.useState(!1),[m,N]=r.useState({}),[y,l]=qt(45e3);r.useEffect(()=>{const j=()=>{const C=localStorage.getItem("user");if(C){const A=JSON.parse(C);let M=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,M=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",M=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,M=!0),M&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};j(),setTimeout(j,100);const k=setTimeout(()=>{o(!0)},1e3);return I(),()=>clearTimeout(k)},[]);const I=async()=>{try{const j=await Ie.get();N(j)}catch(j){console.error("Failed to load settings:",j)}},h=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const j=localStorage.getItem("token"),C=await fetch(`${G}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!C.ok){const A=await C.json();throw new Error(A.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(j){console.error("Failed to clear data:",j),alert("Failed to clear data: "+j.message)}},v=[{id:"overview",label:"Dashboard",icon:Qt,path:"/admin"},{id:"sales",label:"Sales",icon:wt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ee,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Tt,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Je,path:"/admin/expenses"},...g()?[{id:"users",label:"Users",icon:Pe,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:ge,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:xt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:pe,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:ot,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:We,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Yt,path:"/admin/settings"}],u=j=>j==="/admin"?n.pathname==="/admin":n.pathname.startsWith(j);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${a?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[a&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>s(!a),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a?e.jsx(Ue,{className:"w-5 h-5"}):e.jsx(Zt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:v.map(j=>{const k=j.icon;return e.jsxs("button",{onClick:()=>f(j.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${u(j.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(k,{className:"w-5 h-5 flex-shrink-0"}),a&&e.jsx("span",{className:"font-medium",children:j.label})]},j.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Xt,{className:"w-5 h-5 flex-shrink-0"}),a&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(tt,{className:"w-5 h-5 flex-shrink-0"}),a&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:h,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5 flex-shrink-0"}),a&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:v.find(j=>u(j.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(vt,{children:[e.jsx(Y,{path:"/",element:e.jsx(js,{})}),e.jsx(Y,{path:"/sales",element:e.jsx(Ss,{})}),e.jsx(Y,{path:"/inventory",element:e.jsx(vs,{})}),e.jsx(Y,{path:"/recipes",element:e.jsx(ws,{})}),e.jsx(Y,{path:"/expenses",element:e.jsx(ks,{})}),e.jsx(Y,{path:"/reminders",element:e.jsx(Is,{})}),e.jsx(Y,{path:"/service-fees",element:e.jsx(Ts,{})}),e.jsx(Y,{path:"/discounts",element:e.jsx(Ds,{})}),e.jsx(Y,{path:"/credit-requests",element:e.jsx(Es,{})}),e.jsx(Y,{path:"/users",element:e.jsx(Cs,{})}),e.jsx(Y,{path:"/time",element:e.jsx(Ps,{})}),e.jsx(Y,{path:"/settings",element:e.jsx(As,{})})]})})]}),d&&e.jsx(Ot,{onClose:()=>o(!1)}),y&&e.jsx(Rt,{onUnlock:l,logo:m.logo})]})}function Us(){const t=ye(),[i,g]=r.useState(!1),[f,n]=r.useState(0),a=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],s=[{icon:Ee,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Tt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Be,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Pe,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:Le,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Qe,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],d=[{name:"Basic",price:900,icon:$e,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:Ye,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(es,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Re,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(It,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Qe,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map((o,m)=>{const N=o.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(N,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:o.title}),e.jsx("p",{className:"text-gray-600",children:o.desc})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:d.map((o,m)=>{const N=o.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${o.popular?"ring-4 ring-blue-600":""}`,children:[o.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${o.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",o.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:o.features.map((y,l)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:y})]},l))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${o.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Re,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{g(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",f+1," of ",a.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((f+1)/a.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(f+1)/a.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:a[f].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:a[f].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:a[f].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:a[f].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,f-1)),disabled:f===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),f<a.length-1?e.jsxs("button",{onClick:()=>n(f+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Re,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{g(!1),n(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Re,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:a.map((o,m)=>e.jsx("button",{onClick:()=>n(m),className:`w-2 h-2 rounded-full transition-all ${m===f?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},m))})]})]})})]})}function yt(){const t=Nt(),[i,g]=r.useState(t.pathname==="/auth/login"),[f,n]=r.useState("password"),[a,s]=r.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[d,o]=r.useState(""),[m,N]=r.useState(!1),[y,l]=r.useState(!1),I=ye(),{login:h}=fe(),v=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(j){return console.warn("Invalid selectedPlan in localStorage:",j),null}},u=async j=>{j.preventDefault(),o(""),N(!0);try{if(y){if(a.newPassword!==a.confirmPassword){o("Passwords do not match"),N(!1);return}if(a.newPassword.length<6){o("Password must be at least 6 characters"),N(!1);return}const b=await we.login({email:a.email,newPassword:a.newPassword});b.token&&b.user&&(await h(b),I("/dashboard"));return}if(i){if(f==="pin"){if(!a.pin||a.pin.length!==4){o("Please enter a valid 4-digit PIN"),N(!1);return}}else if(!a.password){o("Please enter your password"),N(!1);return}}let k;if(i)if(f==="pin")try{k=await we.pinLogin({email:a.email,pin:a.pin})}catch(b){if(b.message.includes("PIN not set"))o("PIN not set for this user. Please use password login.");else if(b.message.includes("Invalid PIN"))o("Invalid PIN. Please try again.");else throw b;N(!1);return}else k=await we.login({email:a.email,password:a.password});else{const b=v();k=await we.signup({...a,plan:b?.id||"basic"})}if(k.needsPasswordSetup){l(!0),s({...a,email:k.email}),o(""),N(!1);return}if(!k||!k.user||!k.token)throw new Error("Authentication failed. Please try again.");const C={id:Date.now(),type:i?"login":"signup",user:{id:k.user.id,name:k.user.name,email:k.user.email,role:k.user.role,plan:k.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(C),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await h(k);const M=i?"logged in":"signed up";console.log(`âœ… User ${k.user.name} ${M} successfully`),k.user.role==="admin"?I("/admin"):k.user.role==="cashier"||k.user.plan==="basic"?I("/dashboard/cashier"):I("/admin")}catch(k){console.error("Authentication error:",k);let C=k.message||"Authentication failed. Please try again.";k.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),C="Invalid credentials. Please try again."),o(C)}finally{N(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:i?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:i?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[y?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.newPassword,onChange:j=>s({...a,newPassword:j.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.confirmPassword,onChange:j=>s({...a,confirmPassword:j.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!i&&e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.name,onChange:j=>s({...a,name:j.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.email,onChange:j=>s({...a,email:j.target.value}),required:!0})]}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${f==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${f==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),i&&f==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.password,onChange:j=>s({...a,password:j.target.value}),required:!0})]}),i&&f==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.pin,onChange:j=>s({...a,pin:j.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!i&&e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:a.password,onChange:j=>s({...a,password:j.target.value}),required:!0})]})]}),d&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:d}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:m?"Please wait...":y?"Set Password":i?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{g(!i),o(""),l(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:i?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function $s(){const[t,i]=r.useState("ultra"),[g,f]=r.useState(!1),[n,a]=r.useState({name:"",email:"",company:""}),s=ye(),d=[{id:"basic",name:"Basic Package",price:1e3,icon:$e,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:Ye,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],o=async m=>{m.preventDefault();try{await fetch(`${G}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),f(!1),a({name:"",email:"",company:""})}catch(N){console.error("Demo request failed:",N),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(ts,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:d.map(m=>{const N=m.icon;return e.jsxs("div",{onClick:()=>i(m.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===m.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${m.color} flex items-center justify-center`,children:e.jsx(N,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:m.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:m.features.map((y,l)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:y})]},l))})]},m.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const m=d.find(N=>N.id===t);console.log("Selected plan:",m),localStorage.setItem("selectedPlan",JSON.stringify(m)),s("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>f(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:m=>a({...n,name:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:m=>a({...n,email:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:m=>a({...n,company:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Fs(){const{user:t,logout:i}=fe(),[g,f]=r.useState([]),[n,a]=r.useState([]),[s,d]=r.useState([]),[o,m]=r.useState("cash"),[N,y]=r.useState("pos"),[l,I]=r.useState({sales:[],expenses:[],stats:{}}),[h,v]=r.useState(""),[u,j]=r.useState(!1),[k,C]=r.useState(!1),[A,M]=r.useState(null),[b,w]=r.useState({name:"",price:"",cost:"",category:"finished",image:""}),[p,P]=r.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[L,O]=r.useState(!1),[_,ee]=r.useState({description:"",amount:"",category:""}),[ae,J]=r.useState(""),[te,Z]=r.useState([]),[R,q]=r.useState(null),[V,xe]=r.useState("exclusive"),[S,$]=r.useState(!1),[z,H]=r.useState(null),[re,le]=r.useState(null);r.useEffect(()=>{he();const c=localStorage.getItem(`cart_${t?.id}`),U=localStorage.getItem(`paymentMethod_${t?.id}`),E=localStorage.getItem(`selectedDiscount_${t?.id}`),F=localStorage.getItem(`taxType_${t?.id}`),W=localStorage.getItem(`clockStatus_${t?.id}`),ne=localStorage.getItem(`clockInTime_${t?.id}`);if(c)try{d(JSON.parse(c))}catch(Oe){console.warn("Failed to restore cart:",Oe)}if(U&&m(U),F&&xe(F),E)try{q(JSON.parse(E))}catch{}W==="clocked_in"&&($(!0),ne&&le(new Date(ne))),rt()},[t?.id]),r.useEffect(()=>{const c=localStorage.getItem("token");c&&et.connect(c,E=>{if(E&&E.allProducts){const F=E.allProducts.filter(W=>W.visibleToCashier!==!1&&!W.expenseOnly);f(F)}E&&E.discounts&&Z(E.discounts),E&&E.sale&&he()}).catch(E=>{console.warn("WebSocket connection failed:",E)});const U=ps(E=>{try{if(!E)return;(E.type==="initial"||E.type==="products_snapshot"||E.type==="product_created"||E.type==="product_updated"||E.type==="product_deleted")&&de.getAll().then(F=>f(F.filter(W=>W.visibleToCashier!==!1&&!W.expenseOnly))).catch(()=>{})}catch(F){console.error("Product subscription handler error",F)}});return()=>{try{U()}catch{}et.disconnect()}},[]),r.useEffect(()=>{(s.length>0||o||V)&&be()},[s,o,V,R,t?.id]);const be=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(s)),localStorage.setItem(`paymentMethod_${t?.id}`,o),localStorage.setItem(`taxType_${t?.id}`,V),R&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(R))},st=async()=>{try{const c=await fetch(`${G}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_in"})});if(c.ok){const U=await c.json();H(U),$(!0);const E=new Date;le(E),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,E.toISOString()),alert("Clocked in successfully!")}}catch(c){console.error("Clock in failed:",c),alert("Failed to clock in")}},at=async()=>{try{const c=await fetch(`${G}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_out"})});if(c.ok){const U=await c.json();H(U),$(!1),le(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const E=Math.floor(U.duration/60),F=U.duration%60;alert(`Clocked out successfully! Total time: ${E}h ${F}m`)}}catch(c){console.error("Clock out failed:",c),alert("Failed to clock out")}},rt=async()=>{try{const c=await fetch(`${G}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(c.ok){const E=(await c.json()).find(F=>F.cashierId===t?.id&&F.status==="clocked_in");E&&(H(E),$(!0),le(new Date(E.clockInTime)))}}catch(c){console.warn("Failed to check clock status:",c)}},he=async()=>{try{const[c,U,E,F,W]=await Promise.all([de.getAll(),Fe.getAll(),Ze.getAll(),Ut.get(),Xe.getAll()]);f(c.filter(ne=>ne.visibleToCashier!==!1&&!ne.expenseOnly)),I({sales:U,expenses:E,stats:F}),a(W);try{const ne=await fetch(`${G}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(Oe=>Oe.json());Z(ne||[])}catch(ne){console.warn("Failed to load discounts:",ne)}}catch(c){console.error("Failed to load data:",c)}},lt=(c,U=!0)=>{const E=c.target.files[0];if(E){const F=new FileReader;F.onload=W=>{const ne=W.target.result;J(ne),U&&w({...b,image:ne})},F.readAsDataURL(E)}},ve=c=>n.filter(E=>E.productId===c&&E.quantity>0).reduce((E,F)=>E+F.quantity,0),nt=c=>{const U=ve(c.id);if(U<=0){alert("Product is out of stock!");return}const E=s.find(W=>W.id===c.id);if((E?E.quantity:0)>=U){alert(`Only ${U} units available in stock!`);return}d(E?s.map(W=>W.id===c.id?{...W,quantity:W.quantity+1}:W):[...s,{...c,quantity:1}])},x=(c,U)=>{g.find(F=>F.id===c);const E=ve(c);d(s.map(F=>{if(F.id===c){const W=F.quantity+U;return W>E?(alert(`Only ${E} units available!`),F):{...F,quantity:Math.max(1,W)}}return F}).filter(F=>F.quantity>0))},T=c=>{d(s.filter(U=>U.id!==c))},D=s.reduce((c,U)=>c+U.price*U.quantity,0),Q=async()=>{if(s.length!==0)try{const c=R?R.type==="percentage"?D*R.value/100:R.value:0,U=D*.16,E=V==="inclusive"?D-c:D-c+U;await Fe.create({items:s.map(F=>({productId:F.id,quantity:F.quantity,price:F.price})),total:E,discount:c,tax:U,taxType:V,paymentMethod:o}),d([]),q(null),xe("exclusive"),await he(),alert("Sale completed successfully!")}catch(c){console.error("Checkout failed:",c),alert("Sale failed. Please try again.")}},K=async c=>{c.preventDefault();try{await de.create({...b,price:parseFloat(b.price),cost:parseFloat(b.cost||0),quantity:0}),w({name:"",price:"",cost:"",category:"finished",image:""}),J(""),j(!1),await he(),alert("Product added successfully!")}catch(U){console.error("Failed to add product:",U),alert("Failed to add product")}},X=async c=>{c.preventDefault();try{const U=Array.isArray(n)?n:[],F={id:U.length>0?Math.max(...U.map(W=>W.id||0))+1:1,productId:A.id,quantity:parseInt(p.quantity),expiryDate:p.expiryDate,batchNumber:p.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(p.cost||A.cost||0)};a(W=>[...W,F]),await Xe.create({productId:A.id,quantity:parseInt(p.quantity),expiryDate:p.expiryDate,batchNumber:p.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(p.cost||A.cost||0)}),P({quantity:"",expiryDate:"",batchNumber:"",cost:""}),C(!1),M(null),await he(),alert("Stock added successfully!")}catch(U){console.error("Failed to add stock:",U),alert("Failed to add stock")}},je=async c=>{c.preventDefault();try{await Ze.create({..._,amount:parseFloat(_.amount)}),ee({description:"",amount:"",category:""}),O(!1),await he()}catch(U){console.error("Failed to add expense:",U),alert("Failed to add expense")}},ue=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const c=localStorage.getItem("token"),E=await fetch(`${G}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!E.ok){const F=await E.json();throw new Error(F.message||"Failed to clear data")}I({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),d([]),alert("Data cleared successfully!"),await he()}catch(c){console.error("Failed to clear data:",c),alert("Failed to clear data: "+c.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),S&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:at,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(ss,{className:"w-4 h-4"}),"Clock Out"]})]}),!S&&e.jsxs("button",{onClick:st,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(It,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{be(),i()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:ue,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Clear"]}),S&&re&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Clocked In: ",re.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>y("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>y("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Qe,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>y("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ee,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>y("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Je,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),N==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(St,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:h,onChange:c=>v(c.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.filter(c=>c.name?.toLowerCase().includes(h.toLowerCase())).map(c=>{const U=ve(c.id),E=U<10,F=U<=0;return e.jsxs("button",{onClick:()=>nt(c),disabled:F,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${F?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[c.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:c.image,alt:c.name,className:"w-full h-full object-cover"})}),E&&!F&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Se,{className:"w-4 h-4"})}),F&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:c.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${F?"text-red-600":E?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",U]}),E&&!F&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},c.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[s.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:s.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:s.map(c=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:c.name}),e.jsx("button",{onClick:()=>T(c.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(c.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(as,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:c.quantity}),e.jsx("button",{onClick:()=>x(c.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(c.price*c.quantity).toLocaleString()]})]})]},c.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",D.toLocaleString()]})]}),R&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(R.type==="percentage"?D*R.value/100:R.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",V==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[V==="exclusive"?"+":"","KSH ",((D-(R?R.type==="percentage"?D*R.value/100:R.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(V==="exclusive"?D-(R?R.type==="percentage"?D*R.value/100:R.value:0)+(D-(R?R.type==="percentage"?D*R.value/100:R.value:0))*.16:D-(R?R.type==="percentage"?D*R.value/100:R.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:R?.id||"",onChange:c=>{c.target.value?q(te.find(U=>U.id===parseInt(c.target.value))):q(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),te.filter(c=>c.active).map(c=>e.jsxs("option",{value:c.id,children:[c.name," - ",c.type==="percentage"?`${c.value}%`:`KSH ${c.value}`]},c.id))]}),R&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(R.type==="percentage"?D*R.value/100:R.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:V==="exclusive",onChange:c=>xe(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:V==="inclusive",onChange:c=>xe(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:o,onChange:c=>m(c.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:Q,disabled:s.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),N==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(pe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Je,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(pe,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:l.sales.slice(-15).reverse().map((c,U)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(c.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[c.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:c.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.total?.toLocaleString()]})]},U))})]})})]})]}),N==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Product"]})]}),u&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:b.name,onChange:c=>w({...b,name:c.target.value}),required:!0}),e.jsxs("select",{className:"input",value:b.category,onChange:c=>w({...b,category:c.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:b.price,onChange:c=>w({...b,price:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:b.cost,onChange:c=>w({...b,cost:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:c=>lt(c,!0),className:"input"}),e.jsx(kt,{className:"w-5 h-5 text-gray-400"})]}),ae&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ae,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),J(""),w({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),k&&A&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",A.name]}),e.jsxs("form",{onSubmit:X,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:p.quantity,onChange:c=>P({...p,quantity:c.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:p.expiryDate,onChange:c=>P({...p,expiryDate:c.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:p.batchNumber,onChange:c=>P({...p,batchNumber:c.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:p.cost,onChange:c=>P({...p,cost:c.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),M(null),P({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(c=>{const U=ve(c.id),E=n.filter(W=>W.productId===c.id&&W.quantity>0),F=U<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[c.image&&e.jsx("img",{src:c.image,alt:c.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),e.jsx("div",{className:"text-xs text-gray-500",children:c.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${U===0?"text-red-600":F?"text-yellow-600":"text-gray-900"}`,children:U}),F&&U>0&&e.jsx(Se,{className:"w-4 h-4 text-yellow-500"}),U===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[E.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{M(c),C(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(ke,{className:"w-4 h-4"})})]})})]},c.id)})})]})})]})}),N==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>O(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Expense"]})]}),L&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:je,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:_.description,onChange:c=>ee({..._,description:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:_.amount,onChange:c=>ee({..._,amount:c.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:_.category,onChange:c=>ee({..._,category:c.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>O(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:l.expenses.slice().reverse().map((c,U)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(c.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:c.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:c.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",c.amount?.toLocaleString()]})]},U))})]})})]})})]})}function Os(){const[t,i]=r.useState({email:"",password:""}),[g,f]=r.useState(!1),[n,a]=r.useState(""),[s,d]=r.useState(!1),o=ye(),m=r.useRef(!1);r.useEffect(()=>{if(m.current)return;m.current=!0;const y=localStorage.getItem("ownerToken"),l=localStorage.getItem("ownerUser");if(y&&l)try{JSON.parse(l).role==="owner"&&o("/main.admin/dashboard",{replace:!0})}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[o]);const N=async y=>{y.preventDefault(),f(!0),a("");try{const l=await De.login(t);if(l.token&&l.user&&l.user.role==="owner")localStorage.setItem("ownerToken",l.token),localStorage.setItem("ownerUser",JSON.stringify(l.user)),o("/main.admin/dashboard",{replace:!0});else throw new Error("Invalid response from server or insufficient permissions")}catch(l){a(l.message||"Access denied. Owner access only.")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-600 to-red-800 rounded-3xl mx-auto mb-4 flex items-center justify-center border-2 border-red-400 shadow-lg",children:e.jsx("div",{className:"text-3xl font-bold text-white",children:"MTC"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Mabrixel Trading Co. - System Owner Access"}),e.jsx("div",{className:"mt-3 text-xs text-red-500 bg-red-500/10 px-3 py-2 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.email,onChange:y=>i({...t,email:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:s?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.password,onChange:y=>i({...t,password:y.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:s?e.jsx(At,{className:"w-5 h-5"}):e.jsx(dt,{className:"w-5 h-5"})})]}),n&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(He,{className:"w-4 h-4"}),n]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:g?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function Rs(){const[t,i]=r.useState([]),[g,f]=r.useState({}),[n,a]=r.useState(!0),[s,d]=r.useState(null),[o,m]=r.useState("all"),[N,y]=r.useState(null),l=ye();r.useEffect(()=>{const w=localStorage.getItem("ownerToken"),p=localStorage.getItem("ownerUser");if(!w||!p){l("/main.admin",{replace:!0});return}try{const L=JSON.parse(p);if(L.role!=="owner"&&!L.isMainAdmin||L.email!=="ianmabruk3@gmail.com"){l("/main.admin",{replace:!0});return}}catch{l("/main.admin",{replace:!0});return}I();const P=setInterval(I,3e4);return()=>clearInterval(P)},[]);const I=async()=>{try{a(!0);const[w,p]=await Promise.all([De.getUsers(),De.getStats()]);i(w||[]),f(p||{})}catch(w){console.error("Failed to load data:",w)}finally{a(!1)}},h=async(w,p)=>{try{d(`lock-${w}`),await De.lockUser(w,!p),await I()}catch{alert("Failed to update user status")}finally{d(null)}},v=()=>({freeDemo:t.filter(p=>p.planType==="free_demo"||!p.planType).length,trial:t.filter(p=>p.planType==="trial"||p.requestedTrial).length,paid:t.filter(p=>p.planType==="paid").length}),u=()=>o==="all"?t:o==="free_demo"?t.filter(w=>w.planType==="free_demo"||!w.planType):o==="trial"?t.filter(w=>w.planType==="trial"||w.requestedTrial):o==="paid"?t.filter(w=>w.planType==="paid"):t,j=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"N/A"}},k=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),l("/main.admin")};if(n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-red-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Loading system data..."})]})});const C=v(),A=u(),M=t.filter(w=>w.active&&!w.locked).length,b=t.filter(w=>w.locked).length;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black text-white",children:[e.jsx("div",{className:"border-b border-red-500/30 bg-black/50 backdrop-blur-lg sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-600 to-red-800 rounded-2xl flex items-center justify-center border-2 border-red-400",children:e.jsx(Ye,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"ðŸŽ¯ MTC System Owner"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Comprehensive Analytics & Control Dashboard"})]})]}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors",children:[e.jsx(tt,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-6 border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Pe,{className:"w-8 h-8 text-blue-200"}),e.jsx("span",{className:"text-3xl font-bold",children:t.length})]}),e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Users"}),e.jsx("p",{className:"text-blue-300 text-xs mt-2",children:"All registered"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-600 to-green-800 rounded-xl p-6 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ce,{className:"w-8 h-8 text-green-200"}),e.jsx("span",{className:"text-3xl font-bold",children:M})]}),e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Active Users"}),e.jsx("p",{className:"text-green-300 text-xs mt-2",children:"Currently active"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-xl p-6 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"w-8 h-8 text-yellow-200"}),e.jsx("span",{className:"text-3xl font-bold",children:C.trial})]}),e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"Trial/Demo"}),e.jsx("p",{className:"text-yellow-300 text-xs mt-2",children:"Free & trial users"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl p-6 border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-8 h-8 text-purple-200"}),e.jsx("span",{className:"text-3xl font-bold",children:C.paid})]}),e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Paid Users"}),e.jsx("p",{className:"text-purple-300 text-xs mt-2",children:"Active subscriptions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-600 to-red-800 rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"w-8 h-8 text-red-200"}),e.jsx("span",{className:"text-3xl font-bold",children:b})]}),e.jsx("p",{className:"text-red-100 text-sm font-medium",children:"Locked Users"}),e.jsx("p",{className:"text-red-300 text-xs mt-2",children:"Access restricted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/50 border border-red-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-red-400",children:"ðŸ†“ Free Demo Users"}),e.jsx($e,{className:"w-6 h-6 text-red-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:C.freeDemo}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Users on free demo"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?C.freeDemo/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(C.freeDemo/t.length*100):0,"% of users"]})]}),e.jsxs("div",{className:"bg-black/50 border border-yellow-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:"â±ï¸ Trial Users"}),e.jsx(ge,{className:"w-6 h-6 text-yellow-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:C.trial}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Requested/active trials"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?C.trial/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(C.trial/t.length*100):0,"% of users"]})]}),e.jsxs("div",{className:"bg-black/50 border border-green-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-green-400",children:"ðŸ’° Paid Users"}),e.jsx(pe,{className:"w-6 h-6 text-green-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:C.paid}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Paid subscription users"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?C.paid/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(C.paid/t.length*100):0,"% of users"]})]})]}),e.jsxs("div",{className:"bg-black/50 border border-red-500/30 rounded-xl p-6 backdrop-blur-lg mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"ðŸ“Š User Analytics & Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:o,onChange:w=>m(w.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-red-500",children:[e.jsxs("option",{value:"all",children:["All Users (",t.length,")"]}),e.jsxs("option",{value:"free_demo",children:["Free Demo (",C.freeDemo,")"]}),e.jsxs("option",{value:"trial",children:["Trial Users (",C.trial,")"]}),e.jsxs("option",{value:"paid",children:["Paid Users (",C.paid,")"]})]}),e.jsx("button",{onClick:I,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:"Refresh data",children:e.jsx(Pt,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800/50 border-b border-gray-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"User Info"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Plan Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Service Start"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Days Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Trial Request"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:A.length>0?A.map(w=>{const p=w.planType||"free_demo",P=w.daysUsed||0;return e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[w.email==="ianmabruk3@gmail.com"&&e.jsx(Ye,{className:"w-4 h-4 text-yellow-500",title:"Main Admin"}),e.jsx("span",{className:"font-medium text-white",children:w.name})]}),e.jsx("p",{className:"text-gray-400 text-xs",children:w.email})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${p==="paid"?"bg-green-900 text-green-200":p==="trial"?"bg-yellow-900 text-yellow-200":"bg-gray-700 text-gray-200"}`,children:p==="free_demo"?"ðŸ†“ Free Demo":p==="trial"?"â±ï¸ Trial":"ðŸ’° Paid"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:j(w.serviceStartDate)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"font-bold text-blue-400",children:[P," days"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.requestedTrial?e.jsxs("span",{className:"px-2 py-1 bg-yellow-900/30 text-yellow-300 text-xs rounded flex items-center gap-1 w-fit",children:[e.jsx(Se,{className:"w-3 h-3"})," Requested"]}):e.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.active&&!w.locked?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 font-medium text-xs",children:[e.jsx(Ce,{className:"w-4 h-4"})," Active"]}):w.locked?e.jsxs("span",{className:"flex items-center gap-1 text-red-400 font-medium text-xs",children:[e.jsx(ce,{className:"w-4 h-4"})," Locked"]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 font-medium text-xs",children:[e.jsx(Ve,{className:"w-4 h-4"})," Inactive"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>h(w.id,w.locked),disabled:s===`lock-${w.id}`||w.email==="ianmabruk3@gmail.com",className:`px-3 py-1 rounded text-xs font-medium transition-colors ${w.locked?"bg-green-600 hover:bg-green-700 disabled:bg-gray-500 text-white":"bg-red-600 hover:bg-red-700 disabled:bg-gray-500 text-white"}`,children:s===`lock-${w.id}`?"Processing...":w.locked?"Unlock":"Lock"})})]},w.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-400",children:"No users found in this category"})})})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-700 text-sm text-gray-400 flex justify-between",children:[e.jsxs("p",{children:["Showing ",A.length," of ",t.length," users"]}),e.jsxs("p",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/50 border border-blue-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"})," System Overview"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Total Sales"}),e.jsxs("span",{className:"font-bold text-white",children:["KSH ",(g.totalSales||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Total Expenses"}),e.jsxs("span",{className:"font-bold text-white",children:["KSH ",(g.totalExpenses||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Profit"}),e.jsxs("span",{className:"font-bold text-green-400",children:["KSH ",(g.profit||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Products"}),e.jsx("span",{className:"font-bold text-white",children:g.productsCount||0})]})]})]}),e.jsxs("div",{className:"bg-black/50 border border-purple-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-400 mb-4 flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"})," Quick Stats"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Sales Records"}),e.jsx("span",{className:"font-bold text-white",children:g.salesCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Expense Records"}),e.jsx("span",{className:"font-bold text-white",children:g.expensesCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Active Accounts"}),e.jsx("span",{className:"font-bold text-green-400",children:M})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Accounts"}),e.jsx("span",{className:"font-bold text-red-400",children:b})]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-black/50 border border-gray-700 rounded-xl p-6 backdrop-blur-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 mb-4",children:"ðŸ“‹ User Plan Types & Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx($e,{className:"w-5 h-5 text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"ðŸ†“ Free Demo"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"New users getting initial access to test the system"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx(ge,{className:"w-5 h-5 text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"â±ï¸ Trial Users"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Users who requested trial period or using extended trial"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx(pe,{className:"w-5 h-5 text-green-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"ðŸ’° Paid Users"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Users with active paid subscriptions"})]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("p",{className:"text-blue-300 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"ðŸ“Š Days Used:"})," Calculated from service start date to today"]})})]})]})]})}function qs(){const[t,i]=r.useState([]),[g,f]=r.useState("all"),[n,a]=r.useState(""),[s,d]=r.useState(!0),[o,m]=r.useState(null),N=ye(),[y,l]=r.useState({totalUsers:0,activeUsers:0,freeTrialUsers:0,upgradeExpiredUsers:0,reaching30Days:0,totalRevenue:0});r.useEffect(()=>{const b=localStorage.getItem("mainAdminToken"),w=localStorage.getItem("mainAdminUser");if(!b||!w){N("/main-admin/login");return}I().finally(()=>d(!1))},[N]);const I=async()=>{try{let b=[];try{const w=localStorage.getItem("mainAdminToken"),p=await fetch(`${G}/api/main-admin/users-with-subscriptions`,{headers:{Authorization:`Bearer ${w}`}});if(p.ok)b=await p.json();else throw new Error("Failed to fetch subscription data")}catch(w){console.warn("Subscription API failed, using fallback:",w.message);try{b=await De.getUsers()}catch{b=await Ne.getAll()}b=b.map(p=>{const P=new Date(p.createdAt||Date.now()),O=Math.floor((new Date-P)/(1e3*60*60*24)),_=p.plan==="free"||!p.plan,ee=O>=30&&_,ae=Math.max(0,30-O);return{...p,createdAt:P.toISOString(),daysActive:O,isFreeTrial:_,hasReachedTrialLimit:ee,daysUntilExpiry:ae,subscriptionStatus:_?ee?"trial_expired":"free_trial":"paid",planPrice:p.plan==="ultra"?1600:p.plan==="basic"?900:0,trialExpireDate:new Date(P.getTime()+720*60*60*1e3).toISOString()}})}if(b.length>0&&b[0].daysActive!==void 0)i(b),h(b);else{const w=b.map(p=>{const P=new Date(p.createdAt||Date.now()),O=Math.floor((new Date-P)/(1e3*60*60*24)),_=p.plan==="free"||!p.plan,ee=O>=30&&_,ae=Math.max(0,30-O);return{...p,createdAt:P.toISOString(),daysActive:O,isFreeTrial:_,hasReachedTrialLimit:ee,daysUntilExpiry:ae,subscriptionStatus:_?ee?"trial_expired":"free_trial":"paid",planPrice:p.plan==="ultra"?1600:p.plan==="basic"?900:0,trialExpireDate:new Date(P.getTime()+2592e6).toISOString()}});i(w),h(w)}}catch(b){console.error("Failed to load data:",b)}},h=b=>{const w=b.filter(O=>O.isFreeTrial).length,p=b.filter(O=>O.hasReachedTrialLimit).length,P=b.filter(O=>O.daysActive>=25&&O.daysActive<30&&O.isFreeTrial).length,L=b.filter(O=>!O.isFreeTrial&&!O.hasReachedTrialLimit).reduce((O,_)=>O+(_.planPrice||0),0);l({totalUsers:b.length,activeUsers:b.filter(O=>O.active!==!1).length,freeTrialUsers:w,upgradeExpiredUsers:p,reaching30Days:P,totalRevenue:L})},v=b=>b.hasReachedTrialLimit?"bg-red-100 border-red-300":b.daysUntilExpiry<=5&&b.isFreeTrial?"bg-yellow-100 border-yellow-300":b.isFreeTrial?"bg-blue-100 border-blue-300":"bg-green-100 border-green-300",u=b=>b.hasReachedTrialLimit?e.jsx("span",{className:"text-xs bg-red-600 text-white px-2 py-1 rounded-full",children:"Trial Expired"}):b.isFreeTrial?e.jsxs("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full",children:["Free Trial - ",b.daysUntilExpiry,"d left"]}):e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full",children:"Active"}),j=async b=>{const w=t.find(p=>p.id===b);if(w)try{const p=localStorage.getItem("mainAdminToken");if((await fetch(`${G}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Upgrade reminder sent to ${w.email}`);else throw new Error("Failed to send email")}catch(p){console.error("Failed to send email:",p),alert("Failed to send email")}},k=async(b,w)=>{try{m(b);const p=localStorage.getItem("mainAdminToken");if((await fetch(`${G}/api/main-admin/users/${b}/lock`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({locked:!w})})).ok)i(O=>O.map(_=>_.id===b?{..._,locked:!w,active:w}:_)),alert(`User ${w?"unlocked":"locked"} successfully`);else throw new Error("Failed to update user lock status")}catch(p){console.error("Failed to update user lock status:",p),alert("Failed to update user")}finally{m(null)}},C=async b=>{const w=t.find(p=>p.id===b);if(w)try{const p=localStorage.getItem("mainAdminToken");if((await fetch(`${G}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Redirect email sent to ${w.email}`);else throw new Error("Failed to send email")}catch(p){console.error("Failed to send redirect email:",p),alert("Failed to send email")}},A=t.filter(b=>{const w=b.name?.toLowerCase().includes(n.toLowerCase())||b.email?.toLowerCase().includes(n.toLowerCase()),p=g==="all"||g==="free_trial"&&b.isFreeTrial&&!b.hasReachedTrialLimit||g==="trial_expired"&&b.hasReachedTrialLimit||g==="paid"&&!b.isFreeTrial||g==="expiring_soon"&&b.daysUntilExpiry<=5&&b.isFreeTrial;return w&&p}),M=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),N("/main-admin/login")};return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-blue-100 mt-1",children:"User Management & Subscription Tracking"})]}),e.jsxs("button",{onClick:M,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(tt,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:y.totalUsers})]}),e.jsx(Pe,{className:"w-8 h-8 text-blue-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Free Trial"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:y.freeTrialUsers})]}),e.jsx(ge,{className:"w-8 h-8 text-blue-400 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expiring Soon"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:y.reaching30Days})]}),e.jsx(Se,{className:"w-8 h-8 text-yellow-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expired"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:y.upgradeExpiredUsers})]}),e.jsx(Ve,{className:"w-8 h-8 text-red-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:y.activeUsers})]}),e.jsx(Ce,{className:"w-8 h-8 text-green-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Monthly Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["$",(y.totalRevenue/1e3).toFixed(1),"K"]})]}),e.jsx(pe,{className:"w-8 h-8 text-green-600 opacity-20"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b p-6 flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:n,onChange:b=>a(b.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})}),e.jsxs("select",{value:g,onChange:b=>f(b.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"free_trial",children:"Free Trial"}),e.jsx("option",{value:"expiring_soon",children:"Expiring Soon"}),e.jsx("option",{value:"trial_expired",children:"Trial Expired"}),e.jsx("option",{value:"paid",children:"Paid Users"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Days Active"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Trial Expires"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:"No users found matching your criteria"})}):A.map(b=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 transition ${v(b)}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b.name}),e.jsx("p",{className:"text-xs text-gray-500",children:b.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:b.plan||"free"})}),e.jsx("td",{className:"px-6 py-4",children:u(b)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${b.daysActive>=25?"text-red-600":"text-gray-900"}`,children:[b.daysActive," days"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs text-gray-600",children:new Date(b.trialExpireDate).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>C(b.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send upgrade prompt",children:[e.jsx($e,{className:"w-3 h-3"}),"Upgrade"]}),b.daysUntilExpiry<=5&&b.isFreeTrial&&!b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>j(b.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send trial expiry reminder",children:[e.jsx(ls,{className:"w-3 h-3"}),"Remind"]}),e.jsx("button",{onClick:()=>k(b.id,b.locked),disabled:o===b.id,className:`${b.locked?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"} text-white px-3 py-1 rounded text-xs font-semibold transition disabled:opacity-50 flex items-center gap-1`,children:b.locked?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-3 h-3"}),"Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-3 h-3"}),"Lock"]})})]})})]},b.id))})]})})]})]})]})}function Te({children:t,adminOnly:i=!1,ultraOnly:g=!1,ownerOnly:f=!1}){const{user:n,loading:a}=fe(),[s,d]=r.useState(!1),o=qt(6e4),m=o?.[0]||!1,N=o?.[1]||(()=>{}),[y,l]=r.useState({});if(r.useEffect(()=>{n&&!f&&((async()=>{try{const v=localStorage.getItem("token"),j=await fetch(`${G}/settings`,{headers:{Authorization:`Bearer ${v}`}});if(j.ok){const k=await j.json();l(k)}}catch(v){console.error("Failed to load settings:",v)}})(),d(!0))},[n,f]),a&&!f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(f){const h=localStorage.getItem("ownerToken"),v=localStorage.getItem("ownerUser");if(!h||!v)return e.jsx(se,{to:"/main.admin"});try{if(JSON.parse(v).type!=="main_admin")return e.jsx(se,{to:"/main.admin"})}catch{return e.jsx(se,{to:"/main.admin"})}}else{if(!n)return e.jsx(se,{to:"/auth/login"});if(!n.active)return e.jsx(se,{to:"/plans"});if(i&&n.role!=="admin")return e.jsx(se,{to:"/dashboard"});if(g&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(se,{to:"/dashboard"})}const I=f?"owner":"user";return e.jsxs(e.Fragment,{children:[m&&e.jsx(Rt,{onUnlock:N,userType:I}),s&&e.jsx(Ot,{onClose:()=>d(!1)}),t]})}function Ms(){const{user:t}=fe();return!t||!t.active?e.jsx(se,{to:"/plans"}):t.role==="admin"?e.jsx(se,{to:"/admin"}):e.jsx(se,{to:"/dashboard/cashier"})}function Bs(){return e.jsx(gs,{children:e.jsx(bs,{children:e.jsx(zt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(vt,{children:[e.jsx(Y,{path:"/",element:e.jsx(Us,{})}),e.jsx(Y,{path:"/auth/login",element:e.jsx(yt,{})}),e.jsx(Y,{path:"/auth/signup",element:e.jsx(yt,{})}),e.jsx(Y,{path:"/plans",element:e.jsx($s,{})}),e.jsx(Y,{path:"/main.admin",element:e.jsx(Os,{})}),e.jsx(Y,{path:"/main.admin/dashboard",element:e.jsx(Te,{ownerOnly:!0,children:e.jsx(qs,{})})}),e.jsx(Y,{path:"/main.admin/dashboard-legacy",element:e.jsx(Te,{ownerOnly:!0,children:e.jsx(Rs,{})})}),e.jsx(Y,{path:"/dashboard",element:e.jsx(Te,{children:e.jsx(Ms,{})})}),e.jsx(Y,{path:"/dashboard/cashier",element:e.jsx(Te,{children:e.jsx(Fs,{})})}),e.jsx(Y,{path:"/admin/*",element:e.jsx(Te,{adminOnly:!0,children:e.jsx(Ls,{})})}),e.jsx(Y,{path:"/login",element:e.jsx(se,{to:"/auth/login"})}),e.jsx(Y,{path:"/signup",element:e.jsx(se,{to:"/auth/signup"})}),e.jsx(Y,{path:"/subscription",element:e.jsx(se,{to:"/plans"})}),e.jsx(Y,{path:"/payment",element:e.jsx(se,{to:"/plans"})}),e.jsx(Y,{path:"/cashier",element:e.jsx(se,{to:"/dashboard/cashier"})})]})})})})}ms.createRoot(document.getElementById("root")).render(e.jsx(Ht.StrictMode,{children:e.jsx(Bs,{})}));
